<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400, height=500">
    <title>Passdoo</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div id="app" class="passdoo-popup">
        <!-- Header -->
        <header class="popup-header">
            <div class="logo-container">
                <img src="../icons/icon-32.png" alt="Passdoo" class="logo">
                <h1>Passdoo</h1>
            </div>
            <div class="header-actions">
                <button id="btn-refresh" class="icon-btn" title="Aggiorna">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"/>
                    </svg>
                </button>
                <button id="btn-about" class="icon-btn" title="Informazioni">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                </button>
                <button id="btn-settings" class="icon-btn" title="Impostazioni">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Login View -->
        <div id="view-login" class="view" style="display: none;">
            <div class="login-container">
                <div class="login-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                </div>
                <h2>Accedi a Passdoo</h2>
                <p>Effettua l'accesso con il tuo account ODOO per gestire le tue password.</p>
                <button id="btn-login" class="btn btn-primary btn-large">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                        <polyline points="10 17 15 12 10 7"></polyline>
                        <line x1="15" y1="12" x2="3" y2="12"></line>
                    </svg>
                    Accedi con Entra ID
                </button>
                <p class="login-hint">
                    <small>Verrai reindirizzato alla pagina di login di portal.novacs.net</small>
                </p>
            </div>
        </div>

        <!-- Main View (Password List) -->
        <div id="view-main" class="view" style="display: none;">
            <!-- Toolbar: Search + Add Button -->
            <div class="toolbar">
                <div class="search-container">
                    <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="search-input" placeholder="Cerca password..." autocomplete="off">
                    <button id="btn-clear-search" class="clear-search" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <button id="btn-add-password" class="btn btn-primary btn-add-compact">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    Nuova
                </button>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="all">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <line x1="3" y1="6" x2="3.01" y2="6"></line>
                        <line x1="3" y1="12" x2="3.01" y2="12"></line>
                        <line x1="3" y1="18" x2="3.01" y2="18"></line>
                    </svg>
                    Tutte
                </button>
                <button class="tab-btn" data-tab="personal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    Mie
                </button>
                <button class="tab-btn" data-tab="shared">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Condivise
                </button>
            </div>

            <!-- Password List -->
            <div id="password-list" class="password-list">
                <!-- Le password verranno inserite qui dinamicamente -->
            </div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <p id="empty-message">Nessuna password trovata</p>
            </div>
        </div>

        <!-- Add Password View -->
        <div id="view-add-password" class="view" style="display: none;">
            <div class="detail-header">
                <button id="btn-back-add" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <h2>Nuova Password</h2>
            </div>
            
            <form id="form-add-password" class="add-password-form">
                <div class="form-scroll-container">
                    <div class="form-group">
                        <label for="add-name">Nome *</label>
                        <input type="text" id="add-name" required placeholder="Es. Account Gmail">
                    </div>
                    
                    <div class="form-group">
                        <label for="add-username">Username</label>
                        <input type="text" id="add-username" placeholder="Es. mario.rossi@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="add-password">Password *</label>
                        <div class="password-input-group">
                            <input type="password" id="add-password" required placeholder="Inserisci password">
                            <button type="button" id="btn-toggle-add-password" class="icon-btn" title="Mostra/Nascondi">
                                <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                    <circle cx="12" cy="12" r="3"></circle>
                                </svg>
                            </button>
                            <button type="button" id="btn-generate-password" class="icon-btn" title="Genera password">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="add-uri">URL</label>
                        <input type="url" id="add-uri" placeholder="https://esempio.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="add-client">Cliente</label>
                        <select id="add-client">
                            <option value="">-- Nessun cliente --</option>
                            <!-- Opzioni caricate dinamicamente -->
                        </select>
                    </div>
                    
                    <!-- Sezione condivisione gruppi (visibile solo quando selezionato cliente) -->
                    <div id="groups-sharing-section" class="form-group groups-sharing-section" style="display: none;">
                        <label>Condividi con</label>
                        <div id="groups-list" class="groups-list">
                            <!-- Gruppi caricati dinamicamente -->
                        </div>
                        <small class="form-hint">Il gruppo "Amministratore" sarà automaticamente il proprietario. Puoi aggiungere altri gruppi con permessi di lettura o scrittura.</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="add-category">Categoria</label>
                        <select id="add-category">
                            <option value="">Caricamento...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="add-description">Note</label>
                        <textarea id="add-description" rows="2" placeholder="Note aggiuntive..."></textarea>
                    </div>
                </div>
                
                <div class="form-actions-fixed">
                    <button type="button" id="btn-cancel-add" class="btn btn-secondary">Annulla</button>
                    <button type="submit" id="btn-save-password" class="btn btn-primary">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                            <polyline points="17 21 17 13 7 13 7 21"></polyline>
                            <polyline points="7 3 7 8 15 8"></polyline>
                        </svg>
                        Salva
                    </button>
                </div>
            </form>
        </div>

        <!-- Password Detail View -->
        <div id="view-detail" class="view" style="display: none;">
            <div class="detail-header">
                <button id="btn-back" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="19" y1="12" x2="5" y2="12"></line>
                        <polyline points="12 19 5 12 12 5"></polyline>
                    </svg>
                </button>
                <h2 id="detail-title">Dettagli Password</h2>
            </div>
            
            <div class="detail-content">
                <div class="detail-field">
                    <label>Nome</label>
                    <div class="field-value" id="detail-name"></div>
                </div>
                
                <div class="detail-field">
                    <label>Username</label>
                    <div class="field-value-row">
                        <span id="detail-username"></span>
                        <button class="copy-btn" data-copy="username" title="Copia username">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="detail-field">
                    <label>Password</label>
                    <div class="field-value-row">
                        <span id="detail-password" class="password-masked">••••••••</span>
                        <button id="btn-toggle-password" class="icon-btn" title="Mostra/Nascondi password">
                            <svg class="icon-eye" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                <circle cx="12" cy="12" r="3"></circle>
                            </svg>
                            <svg class="icon-eye-off" style="display: none;" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                                <line x1="1" y1="1" x2="23" y2="23"></line>
                            </svg>
                        </button>
                        <button class="copy-btn" data-copy="password" title="Copia password">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="detail-field" id="detail-uri-container" style="display: none;">
                    <label>URL</label>
                    <div class="field-value-row">
                        <a id="detail-uri" href="#" target="_blank" class="uri-link"></a>
                        <button class="copy-btn" data-copy="uri" title="Copia URL">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div class="detail-field" id="detail-description-container" style="display: none;">
                    <label>Note</label>
                    <div class="field-value" id="detail-description"></div>
                </div>
            </div>
            
            <div class="detail-actions">
                <button id="btn-fill-credentials" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Compila nella Pagina
                </button>
            </div>
        </div>

        <!-- User Info Footer -->
        <footer id="user-footer" class="popup-footer" style="display: none;">
            <div class="user-info">
                <span id="user-name"></span>
            </div>
            <button id="btn-logout" class="btn btn-text">Esci</button>
        </footer>

        <!-- Toast Notifications -->
        <div id="toast-container" class="toast-container"></div>

        <!-- About Modal -->
        <div id="about-modal" class="about-modal" style="display: none;">
            <div id="about-modal-backdrop" class="about-modal-backdrop"></div>
            <div class="about-modal-content">
                <div class="about-modal-header">
                    <h2>Informazioni</h2>
                    <button id="about-close-btn" class="about-close-btn" title="Chiudi">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                <div class="about-body">
                    <div class="about-logo">
                        <img src="../icons/icon-128.png" alt="Passdoo" width="80" height="80">
                    </div>
                    <h3 class="about-title">Passdoo</h3>
                    <p class="about-subtitle">Browser Extension</p>
                    <p class="about-version" id="about-version">Versione ...</p>
                    <div class="about-info">
                        <div class="about-row about-row-centered">
                            <span class="about-value">Silvio Balduzzi - NovaCS S.r.l.</span>
                        </div>
                        <div class="about-row">
                            <span class="about-label">Sito Web</span>
                            <a href="https://www.novacs.net" target="_blank" class="about-link-value">www.novacs.net</a>
                        </div>
                        <div class="about-row">
                            <span class="about-label">Supporto</span>
                            <a href="mailto:support@novacs.net" class="about-link-value">support@novacs.net</a>
                        </div>
                    </div>
                    <p class="about-description">
                        Passdoo è un gestore di password sicuro e moderno, 
                        progettato per semplificare la gestione delle credenziali 
                        aziendali con autenticazione Microsoft Entra ID.
                    </p>
                    <p class="about-copyright">© 2025 NovaCS S.r.l. - Tutti i diritti riservati</p>
                </div>
            </div>
        </div>

        <!-- Global Loading Overlay -->
        <div id="loading-state" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <p>Caricamento...</p>
            </div>
        </div>
    </div>

    <script src="popup.js" type="module"></script>
</body>
</html>
